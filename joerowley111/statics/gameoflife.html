<html>
<head>
<script type="text/javascript" language="javascript">
var numberCellsX=200;
var numberCellsY=200;
var cellsize = 5;
var bw = numberCellsX * cellsize;
var bh = numberCellsY * cellsize;
//offset
var p = 0;
var cw = bw + (p*2) + 1;
var ch = bh + (p*2) + 1;

function draw() {
	var canvas = document.getElementById("canvas");
	var context = canvas.getContext("2d");
	function drawBoard(){
	//draw the grid
	//verticle lines
	for (var x = 0; x <= bw; x += cellsize) {
	    context.moveTo(0.5 + x + p, p);
	    context.lineTo(0.5 + x + p, bh + p);
	}
	
	//horizontal lines
	for (var x = 0; x <= bh; x += cellsize) {
	    context.moveTo(p, 0.5 + x + p);
	    context.lineTo(bw + p, 0.5 + x + p);
	}
	
	context.strokeStyle = "black";
	context.stroke();
	}
	
	drawBoard();
	
}

var alive = false;
var life = new Array();
life = [[1,2],[3,4],[5,6]];

function painter(){
	paintCord(5,2,true);
	paintCord(2,3,true);
	paintCord(2,2,false);
	paintCord(0,0,false);
}

function paintCord(x,y,alive) {
 ////console.log("painting cord" + x +", " + y + ", " + alive);
 var canvas = document.getElementById("canvas");
 var canvasContext = canvas.getContext("2d");
 if (alive) canvasContext.fillStyle = "rgb(200,0,0)";
 else canvasContext.fillStyle = "rgb(200,200,200)";
 canvasContext.fillRect (1 + x*cellsize + p, 1 + y*cellsize + p, cellsize-1, cellsize-1);
}

function paintCell(cell){
	if (cell != null){
	paintCord(cell.x, cell.y, cell.alive);
	}
}

function clearIt() {
 //console.log("clearing it");
 var canvas = document.getElementById("canvas");
 var canvasContext = canvas.getContext("2d");
 canvasContext.fillStyle = "rgb(255,255,255)";
 for (var x = 0; x < bw; x += cellsize) {
 	for (var y = 0; y < bh; y += cellsize) {
	    canvasContext.fillRect (1 + x + p, 1 + y + p, cellsize, cellsize);
	    }
 }
 draw();
}

var inputs;

function parseInput(){
	for(var i=0; i<inputs.length; i++) { inputs[i] = +inputs[i]; } 
	var numgens = inputs[0];
	var numIns = inputs[1];
	document.getElementById('numberToRun').innerHTML = inputs[0];
	////console.log("inputs[0]" + inputs[0]);
	////console.log("inputs[1]" + inputs[1]);
	for (var i = 2; i <= 2*numIns; i += 2){
		////console.log("adding cord (" + inputs[i] + "," + inputs[i+1] + ")");
		//paintCord (inputs[i],inputs[i+1], true)
		addCellToGrid(inputs[i],inputs[i+1], true, 0);
		//var newcell = new cell(inputs[i],inputs[i+1], true, 0);
		//liveArray[liveArray.length-1] = newcell;
	    //grid[inputs[i]][inputs[i+1]] = newcell;
	} 
}

function cell(x,y,alive,count){
	this.x=x;
	this.y=y;
	this.alive=alive;
	this.count=count;
	this.changeState=changeState;
	function changeState(){
		this.alive= !this.alive;
	}
	this.Neighbor=Neighbor
	function Neighbor(numBros){
		this.count=numBros;
	}
}

var liveArray = new Array();
var liveArrayNext = new Array();
//liveArray[0] = new cell(2,12,true,4);
var broArray = new Array();
var endOfLiveArray = 0;
var endOfBroArray = 0;

//initialize the grid/2d array
var grid=new Array(numberCellsX)
for (i=0; i <numberCellsX; i++){
	grid [i]=new Array(numberCellsY);
}	

//grid[0][0]=liveArray[0];

function addCellToGrid(x,y,alive,count){
	var newcell = new cell(x,y,alive,count);
   	if (alive == true){
	   	liveArray[liveArray.length] = newcell;
	    grid[x][y] = newcell;
	    //endOfLiveArray++;
	    debugCell(newcell);
   	}
   	else{
	   	broArray[broArray.length] = newcell;
	   	//console.log("adding following cell to bro array:");
	   	debugCell(newcell);
	   	grid[x][y] = newcell;
	   	//endOfBroArray++;
   	}	
   	//printLiveArray();
   	//paintCell(newcell);
}

function addCellToNextGrid(x,y,alive,count){
	var newcell = new cell(x,y,alive,count);
   	if (alive == true){
	   	liveArrayNext[liveArrayNext.length] = newcell;
	    grid[x][y] = newcell;
	    //endOfLiveArray++;
	    debugCell(newcell);
   	}
   	else{
	   	broArray[broArray.length] = newcell;
	   	grid[x][y] = newcell;
	   	//endOfBroArray++;
   	}	
   	//printLiveArray();
   	//paintCell(newcell);
}

function addBros(celli){
	//console.log("Checking Bros for" + celli.x + ", " + celli.y)
	x = parseInt(celli.x);
	y = parseInt(celli.y);
	//console.log("BroArrayLength: " + broArray.length);
	for (i=-1; i<2; i++){
		for (j=-1; j<2; j++){
				if (x == (x+i) && y == (y+j)) {
					//console.log("its me");
				}

			else {
				var xx =x+i;
				var yy = y+i; 
				
				 ////console.log("adding bro");
				if  ( (-1 < xx ) && (numberCellsX > xx ) ){ 
				if  ( (-1 < yy ) && (numberCellsY > yy ) ) {
				//console.log("testing " + (x+i) + ", " + (y+j) );
				
				if (grid[x+i][y+j] == null) {
					//console.log("it's null so I'm adding one "); 
					addCellToGrid(x+i,y+j,false,0);
				}
				if (grid[x+i][y+j] == undefined) {
					addCellToGrid(x+i,y+j,false,0);
					//console.log("it's undefined so I'm adding one "); 	
				}
				if (grid[x+i][y+j].alive != true) {
					if (grid[x+i][y+j].count != false) {
					
					addCellToGrid(x+i,y+j,false,0);
					//console.log("adding one because not alive "); 
				}}}
					}
			}
			
		}
	}
}	
//returns the number of live neighbors around a given cell
function liveCount(celli){
	//console.log("counting live for broArray " + celli.x + ", " + celli.y)
	x = parseInt(celli.x);
	y = parseInt(celli.y);
	var count = 0;
	for (i=-1; i<2; i++){
		for (j=-1; j<2; j++){
			//if (0 < (x+i) < 30 && 0 < (y+j) < 30){
				
				if (x == (x+i) && y == (y+j)) {
				//console.log("its me");
				}

				else{ 
					xx =x+i;
					yy = y+i;
					if  ( (-1 < xx ) && (numberCellsX > xx ) ){ 
					if  ( (-1 < yy ) && (numberCellsY > yy ) ){ 	
					//console.log("testing " + xx + ", " + yy );
					//if (grid[xx][yy] != null){
					var tmpCell = grid[x+i][y+j];
					if (tmpCell != null)  {
						if (grid[(x+i)][(y+j)].alive == true) {
						////console.log("incrementing count of "+ x + ", " + y);
						////console.log("because of " + (x+i) + ", " + (y+j) );
						count++;
					}
					}}}
					
				}
				//}
		}
	}
	return count;
}

function debugCell(cell){
	//console.log(cell.x + ", "+ cell.y + " " + cell.alive + ", " + cell.count);
}

function debugAll(cell){
	for (i=0; i<numberCellsX; i++){
		for (j=0; j<numberCellsY; j++){
			if (grid[i][j] != null){
//				if (grid[i][j].alive == true) debugCell(grid[i][j]);
				//debugCell(grid[i][j]);
				cell = grid[i][j];
				var myspan = document.getElementById("stats");
			    myspan.onclick = function() { alert ("hi"); };
			
			    var mydiv = document.getElementById("mydiv");
			    var newcontent = document.createElement('div');
			    newcontent.innerHTML = (cell.x + ", "+ cell.y + " " + cell.alive + ", " + cell.count + "<br>");
			    while (newcontent.firstChild) {
			        mydiv.appendChild(newcontent.firstChild);
			    }
			}
		}
	}
}



Array.prototype.remove = function(from, to) {
  var rest = this.slice((to || from) + 1 || this.length);
  this.length = from < 0 ? this.length + from : from;
  return this.push.apply(this, rest);
};



function step(){
	//console.log("stepping");
	//console.log("we should go throug broarray now times" + broArray.length);
	for (kk=0; kk<broArray.length; kk++){
		var theCell = broArray[kk];
		//console.log("Stepping broArray[" + kk + "]");
		if (broArray[kk].count == 3){
			//console.log("we have birth! " + theCell.x + ", " + theCell.y);
			addCellToNextGrid(theCell.x, theCell.y, true, 0);
			//printNextLiveArray();
			//broArray.remove(index);
		}
	}
	for (index=0; index<liveArray.length; index++){
		var theCell = liveArray[index];
		//console.log("liveArray[" + index + "]");
		//debugCell(liveArray[i]);
		if(theCell == null) continue;
		if (theCell.count < 2  && theCell.alive == true){
			//console.log("deleting cell " + theCell.x + ", " + theCell.y + "because < 2");
			//liveArray.remove(index);			
			theCell.alive = false;
			//cleanupBros(theCell);
			grid[theCell.x][theCell.y]= null;
			//var lastLiveElement=liveArray[liveArray.length-1];
			//liveArray[i] = null;
			//liveArray[i] = lastLiveElement;
			//liveArray[liveArray.length-1]=null;
			//broArray[broArray.length]=theCell;
		}
		if (theCell.count > 3  && theCell.alive == true){
			//console.log("deleting cell " + theCell.x + ", " + theCell.y + "because >3");
			//liveArray.remove(index);			
			theCell.alive = false;
			//cleanupBros(theCell);
			grid[theCell.x][theCell.y]= null;
			//var lastLiveElement=liveArray[liveArray.length-1];
			//liveArray[i] = null;
			//liveArray[i] = lastLiveElement;
			//liveArray[liveArray.length-1]=null;
			//broArray[broArray.length]=theCell;
		}
		if (theCell.count == 2  && theCell.alive == true){
			//console.log("cell " + theCell.x + ", " + theCell.y + " lives because = 2");
			//liveArray.remove(index);	
			//console.log("adding cell to next grid");
			addCellToNextGrid(theCell.x, theCell.y, true, 0);
			//printNextLiveArray();
			}
		if (theCell.count == 3  && theCell.alive == true){
			//console.log("cell " + theCell.x + ", " + theCell.y + " lives because = 3");
			//liveArray.remove(index);	
			//console.log("adding cell to next grid");
			addCellToNextGrid(theCell.x, theCell.y, true, 0);
			//printNextLiveArray();
			}	
	}

	

}


function applyCounts(){
	for (anotherI=0; anotherI<liveArray.length; anotherI++){
		//console.log("going to count livearray[" + anotherI);
		liveArray[anotherI].count=liveCount(liveArray[anotherI]);
	}
	for (iagain=0; iagain<broArray.length; iagain++){
		broArray[iagain].count=liveCount(broArray[iagain]);
	}
}


function step2(){
	//console.log("REALLLL STEPPPPPP");
	//console.log("REALLLL STEPPPPPP");
	//console.log("REALLLL STEPPPPPP");
	//console.log("REALLLL STEPPPPPP");
	//console.log("live length: " +liveArray.length);
	for (thei=0; thei<liveArray.length; thei++){
		addBros(liveArray[thei]);
	}
	//addBros(liveArray[1]);
	//addBros(liveArray[2]);
	//console.log("testttt" + broArray.length);
	
	applyCounts();
	//console.log("testttt" + broArray.length);
	step();
	
	////console.log("broarray.length = " + broArray.length);
	
	 liveArray=null;
	 liveArray=liveArrayNext;
	 liveArrayNext= new Array();
	 broArray=new Array();

	 clearIt();
	 printCells();

}


function printLiveArray(){
	for (indexy=0; indexy<liveArray.length; indexy++){
		//console.log("-------liveArray[" + indexy+"]= " + liveArray[indexy].x + ", "+ liveArray[indexy].y + " " + liveArray[indexy].alive + " " + liveArray[indexy].count ); 
	}
	for (indexy=0; indexy<broArray.length-1; indexy++){
		if(broArray[indexy] != null){
		//console.log("-------broArray[" + indexy+"]= " + broArray[indexy].x + ", "+ broArray[indexy].y + " " + broArray[indexy].alive + " " + broArray[indexy].count ); 
		}
	}	
}

function printNextLiveArray(){
	for (indexy=0; indexy<liveArray.length; indexy++){
		//console.log("-------liveArray[" + indexy+"]= " + liveArray[indexy].x + ", "+ liveArray[indexy].y + " " + liveArray[indexy].alive + " " + liveArray[indexy].count ); 
	}

	for (indexy=0; indexy<liveArrayNext.length; indexy++){
		//console.log("-------NextliveArray[" + indexy+"]= " + liveArrayNext[indexy].x + ", "+ liveArrayNext[indexy].y + " " + liveArrayNext[indexy].alive + " " + liveArrayNext[indexy].count ); 
	}
	for (indexy=0; indexy<broArray.length-1; indexy++){
		if(broArray[indexy] != null){
		//console.log("-------broArray[" + indexy+"]= " + broArray[indexy].x + ", "+ broArray[indexy].y + " " + broArray[indexy].alive + " " + broArray[indexy].count ); 
		}
	}	
}


function printCells(){
	////console.log(liveArray[0].x + ", " + liveArray[0].y);
	for (i=0; i<liveArray.length; i++){
		paintCell(liveArray[i]);
		//console.log("printing liveArray[" + i + "]");	
		//console.log(liveArray[i].x + ", " + liveArray[i].y);
	}
	//console.log("live have been printed");
	if (broArray.length != null ){
	for (i=0; i<broArray.length; i++){
		paintCell(broArray[i]);	
	}}
	//console.log(liveArray.length);
	////console.log("number to check " + endOfLiveArray);
	
	/*
checkBros(liveArray[0]);
	checkBros(liveArray[1]);
*/
}

</script>


</head>
<body>
<body onload="draw()">
	<table border="1">
<tr>
<td></td>
<td><div id='mydiv'>
<span id='stats'>0</span>
</div></td>
</tr>
</table>
<canvas id="canvas" width="700px" height="700px" style="background: #fff;     magrin:20px;"></canvas>
	

<br>
<input type="file" id="fileinput" />
<script type="text/javascript">
  
  function readSingleFile(evt) {
    //Retrieve the first (and only!) File from the FileList object
    var f = evt.target.files[0]; 

    if (f) {
      var r = new FileReader();
      r.onload = function(e) { 
	      var contents = e.target.result;
        ////console.log(contents);
        
        //work on regex for spliting all whitespace and newlines
        inputs=contents.split(/\W/);
        // var myArray=contents.split(/\W/);
        // for(var i=0; i<myArray.length; i++) { myArray[i] = +myArray[i]; } 
        // for(var i=0; i<myArray.length; i++) { alert(myArray[i]); } 
        
        //autoload once select file
        parseInput()
      }
      r.readAsText(f);
    } else { 
      //console.log("Failed to load file");
    }
  }
  document.getElementById('fileinput').addEventListener('change', readSingleFile, false);
  
 
</script>
<!--
<br>
<input type='button' onclick='parseInput()' value='Load File'/>
-->
<br>
Number of Generations ran 0 of <span id='numberToRun'>0</span>.
<br>
<button onclick="clearIt()">Clear it</button>
<br>
<button onclick="painter();">Cord</button>
<br>
<button onclick="testCell(2,2,true,4);">Create Cell</button>
<button onclick="printCells();">Print Cells</button>
<button onclick="debugAll();">Debug All Cells</button>
<button onclick="checker();">CheckBros</button>
<button onclick="step();">Step</button>
<button onclick="zeroBroCount();">Zero All Counts</button>
<button onclick="printLiveArray();">Print Live Array</button>
<button onclick="step2();">Real step</button>

<br>

</body>
</html>